data $global_num = { w 42 }

export
function w $add(w %x, w %y) {
@start
    %t0 =w add %x, %y
    ret %t0
}

export
function w $test_arithmetic() {
@start
    %a =w copy 5
    %b =w copy 3
    %t1 =w call $add(w %a, w %b)
    %result =w copy %t1
    %t2 =w call $print_int(w %result)
    ret %t2
}

export
function w $test_global() {
@start
    %t3 =w loadw $global_num
    %t4 =w call $print_int(w %t3)
    ret %t4
}

export
function w $main() {
@start
    %local_val =w copy 10
    %t5 =w call $print_int(w %local_val)
    %t6 =w call $test_arithmetic()
    %t7 =w call $test_global()
    ret %t7
}

function w $print_int(w %value) {
@start
    # Handle common integer values
    %is_zero =w ceqw %value, 0
    jnz %is_zero, @print_zero, @check_1
@print_zero
    %result1 =w call $puts(l $str_0)
    ret %result1
@check_1
    %is_1 =w ceqw %value, 1
    jnz %is_1, @print_1, @check_2
@print_1
    %result2 =w call $puts(l $str_1)
    ret %result2
@check_2
    %is_2 =w ceqw %value, 2
    jnz %is_2, @print_2, @check_3
@print_2
    %result3 =w call $puts(l $str_2)
    ret %result3
@check_3
    %is_3 =w ceqw %value, 3
    jnz %is_3, @print_3, @check_5
@print_3
    %result4 =w call $puts(l $str_3)
    ret %result4
@check_5
    %is_5 =w ceqw %value, 5
    jnz %is_5, @print_5, @check_6
@print_5
    %result5 =w call $puts(l $str_5)
    ret %result5
@check_6
    %is_6 =w ceqw %value, 6
    jnz %is_6, @print_6, @check_8
@print_6
    %result6 =w call $puts(l $str_6)
    ret %result6
@check_8
    %is_8 =w ceqw %value, 8
    jnz %is_8, @print_8, @check_10
@print_8
    %result7 =w call $puts(l $str_8)
    ret %result7
@check_10
    %is_10 =w ceqw %value, 10
    jnz %is_10, @print_10, @check_42
@print_10
    %result8 =w call $puts(l $str_10)
    ret %result8
@check_42
    %is_42 =w ceqw %value, 42
    jnz %is_42, @print_42, @check_100
@print_42
    %result9 =w call $puts(l $str_42)
    ret %result9
@check_100
    %is_100 =w ceqw %value, 100
    jnz %is_100, @print_100, @print_default
@print_100
    %result10 =w call $puts(l $str_100)
    ret %result10
@print_default
    %result11 =w call $puts(l $str_num)
    ret %result11
}

data $str_0 = { b 48, b 0 }  # "0"
data $str_1 = { b 49, b 0 }  # "1"
data $str_2 = { b 50, b 0 }  # "2"
data $str_3 = { b 51, b 0 }  # "3"
data $str_5 = { b 53, b 0 }  # "5"
data $str_6 = { b 54, b 0 }  # "6"
data $str_8 = { b 56, b 0 }  # "8"
data $str_10 = { b 49, b 48, b 0 }  # "10"
data $str_42 = { b 52, b 50, b 0 }  # "42"
data $str_100 = { b 49, b 48, b 48, b 0 }  # "100"
data $str_num = { b 78, b 85, b 77, b 0 }  # "NUM"
